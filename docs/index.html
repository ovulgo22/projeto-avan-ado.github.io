<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Documentário Cinemático do Big Bang</title>
<style>
  body, html { margin:0; padding:0; overflow:hidden; background:black; }
  canvas { display:block; }
</style>
</head>
<body>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.141.0/examples/jsm/controls/OrbitControls.js';

// --- Cena, câmera e renderizador ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.z = 50;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.enablePan = false;
controls.minDistance = 5;
controls.maxDistance = 500;

// --- Grupos de objetos ---
const particlesGroup = new THREE.Group();
scene.add(particlesGroup);

const galaxiesGroup = new THREE.Group();
scene.add(galaxiesGroup);

const nebulasGroup = new THREE.Group();
scene.add(nebulasGroup);

const blackHolesGroup = new THREE.Group();
scene.add(blackHolesGroup);

// --- Funções auxiliares ---
// Criar partículas básicas
function createParticles(num, spread, size, colors){
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(num*3);
    const particleColors = new Float32Array(num*3);
    const color = new THREE.Color();

    for(let i=0;i<num;i++){
        positions[i*3] = (Math.random()-0.5)*spread;
        positions[i*3+1] = (Math.random()-0.5)*spread;
        positions[i*3+2] = (Math.random()-0.5)*spread;

        color.set(colors[Math.floor(Math.random()*colors.length)]);
        particleColors[i*3] = color.r;
        particleColors[i*3+1] = color.g;
        particleColors[i*3+2] = color.b;
    }

    geometry.setAttribute('position', new THREE.BufferAttribute(positions,3));
    geometry.setAttribute('color', new THREE.BufferAttribute(particleColors,3));

    const material = new THREE.PointsMaterial({
        size: size,
        vertexColors: true,
        blending: THREE.AdditiveBlending,
        transparent: true,
        depthWrite:false
    });

    const points = new THREE.Points(geometry, material);
    particlesGroup.add(points);
}

// Criar galáxias espirais
function createGalaxy(cx, cy, cz, arms, particlesPerArm, radius){
    const geometry = new THREE.BufferGeometry();
    const positions = [];
    const colors = [];
    const color = new THREE.Color();

    for(let i=0;i<arms;i++){
        for(let j=0;j<particlesPerArm;j++){
            const angle = (j/particlesPerArm)*Math.PI*2 + (i*2*Math.PI/arms);
            const r = (j/particlesPerArm)*radius;
            const x = cx + r*Math.cos(angle);
            const y = cy + r*Math.sin(angle);
            const z = cz + (Math.random()-0.5)*0.5;

            positions.push(x,y,z);
            color.setHSL(Math.random(),1.0,0.5);
            colors.push(color.r,color.g,color.b);
        }
    }

    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors,3));

    const material = new THREE.PointsMaterial({
        size:0.05,
        vertexColors:true,
        blending:THREE.AdditiveBlending,
        depthWrite:false
    });

    const points = new THREE.Points(geometry, material);
    galaxiesGroup.add(points);
}

// Criar nebulosas
function createNebula(cx, cy, cz, radius, colorHex){
    const geometry = new THREE.BufferGeometry();
    const positions = [];
    const colors = [];
    const color = new THREE.Color(colorHex);

    for(let i=0;i<2000;i++){
        const angle = Math.random()*Math.PI*2;
        const r = Math.random()*radius;
        const x = cx + r*Math.cos(angle);
        const y = cy + r*Math.sin(angle);
        const z = cz + (Math.random()-0.5)*radius/2;

        positions.push(x,y,z);
        colors.push(color.r,color.g,color.b);
    }

    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors,3));

    const material = new THREE.PointsMaterial({
        size:0.1,
        vertexColors:true,
        blending:THREE.AdditiveBlending,
        transparent:true,
        depthWrite:false
    });

    const points = new THREE.Points(geometry, material);
    nebulasGroup.add(points);
}

// Criar buracos negros
function createBlackHole(x, y, z, size){
    const geometry = new THREE.SphereGeometry(size,16,16);
    const material = new THREE.MeshBasicMaterial({color:0x000000});
    const blackHole = new THREE.Mesh(geometry,material);
    blackHole.position.set(x,y,z);
    blackHolesGroup.add(blackHole);
}

// --- Sequência cronológica do universo (3 minutos) ---
// 1. Singularidade e inflação (0-20s)
setTimeout(()=>{ createParticles(5000,1,0.05,['#ffffff','#ffffaa','#ffcc88']); },0);
setTimeout(()=>{ createParticles(10000,5,0.05,['#ffffff','#ffffaa','#ffcc88']); },5000);

// 2. Radiação cósmica de fundo (20-40s)
setTimeout(()=>{ createParticles(5000,15,0.03,['#ff5555','#ffaa33','#ffcc77']); },20000);

// 3. Formação de átomos e matéria (40-60s)
setTimeout(()=>{ createParticles(5000,20,0.04,['#88ccff','#aaffaa']); },40000);

// 4. Primeiras estrelas e supernovas (60-100s)
setTimeout(()=>{ createGalaxy(10,0,0,4,1200,5); createGalaxy(-15,5,0,3,1000,4); },60000);
setTimeout(()=>{ createParticles(1000,3,0.08,['#ffffff','#ffff33']); },80000);

// 5. Nebulosas coloridas e evolução de galáxias (100-160s)
setTimeout(()=>{
    createNebula(0,10,0,5,0xff00ff);
    createNebula(10,-5,0,4,0x00ffff);
    createNebula(-10,-10,0,3,0xffaa00);
},100000);

// 6. Formação de buracos negros e núcleos galácticos (160-200s)
setTimeout(()=>{
    createBlackHole(10,0,0,1);
    createBlackHole(-15,5,0,1.2);
},160000);

// 7. Expansão contínua do universo (200-180s)
let elapsed = 0;

// --- Animação contínua ---
function animate(){
    requestAnimationFrame(animate);
    controls.update();

    // Expandir partículas simulando a expansão do universo
    particlesGroup.children.forEach(points=>{
        const positions = points.geometry.attributes.position.array;
        for(let i=0;i<positions.length;i+=3){
            positions[i] *= 1.0005;
            positions[i+1] *= 1.0005;
            positions[i+2] *= 1.0005;
        }
        points.geometry.attributes.position.needsUpdate = true;
    });

    // Rotação das galáxias
    galaxiesGroup.children.forEach(g=>{
        g.rotation.z += 0.0005;
    });

    // Pulsação das nebulosas
    nebulasGroup.children.forEach(n=>{
        n.material.opacity = 0.3 + 0.2*Math.sin(Date.now()/2000);
    });

    renderer.render(scene,camera);
}

animate();

// --- Responsividade ---
window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
